@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: Geist Mono, ui-monospace, monospace;
  --font-mono: Geist Mono, ui-monospace, monospace;
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --font-serif: Besley, ui-serif, serif;
  --radius: 2.168rem;
  --tracking-tighter: calc(var(--tracking-normal) - 0.05em);
  --tracking-tight: calc(var(--tracking-normal) - 0.025em);
  --tracking-wide: calc(var(--tracking-normal) + 0.025em);
  --tracking-wider: calc(var(--tracking-normal) + 0.05em);
  --tracking-widest: calc(var(--tracking-normal) + 0.1em);
  --tracking-normal: var(--tracking-normal);
  --shadow-2xl: var(--shadow-2xl);
  --shadow-xl: var(--shadow-xl);
  --shadow-lg: var(--shadow-lg);
  --shadow-md: var(--shadow-md);
  --shadow: var(--shadow);
  --shadow-sm: var(--shadow-sm);
  --shadow-xs: var(--shadow-xs);
  --shadow-2xs: var(--shadow-2xs);
  --spacing: var(--spacing);
  --letter-spacing: var(--letter-spacing);
  --shadow-offset-y: var(--shadow-offset-y);
  --shadow-offset-x: var(--shadow-offset-x);
  --shadow-spread: var(--shadow-spread);
  --shadow-blur: var(--shadow-blur);
  --shadow-opacity: var(--shadow-opacity);
  --color-shadow-color: var(--shadow-color);
  --color-destructive-foreground: var(--destructive-foreground);
}

:root {
  --radius: 2.168rem;
  --background: oklch(1.0000 0 0);
  --foreground: oklch(0.2101 0.0318 264.6645);
  --card: oklch(1.0000 0 0);
  --card-foreground: oklch(0.2101 0.0318 264.6645);
  --popover: oklch(1.0000 0 0);
  --popover-foreground: oklch(0.2101 0.0318 264.6645);
  --primary: oklch(0.6716 0.1368 48.5130);
  --primary-foreground: oklch(1.0000 0 0);
  --secondary: oklch(0.5360 0.0398 196.0280);
  --secondary-foreground: oklch(1.0000 0 0);
  --muted: oklch(0.9670 0.0029 264.5419);
  --muted-foreground: oklch(0.5510 0.0234 264.3637);
  --accent: oklch(0.9491 0 0);
  --accent-foreground: oklch(0.2101 0.0318 264.6645);
  --destructive: oklch(0.6368 0.2078 25.3313);
  --border: oklch(0.9276 0.0058 264.5313);
  --input: oklch(0.9276 0.0058 264.5313);
  --ring: oklch(0.6716 0.1368 48.5130);
  --chart-1: oklch(0.5940 0.0443 196.0233);
  --chart-2: oklch(0.7214 0.1337 49.9802);
  --chart-3: oklch(0.8721 0.0864 68.5474);
  --chart-4: oklch(0.6268 0 0);
  --chart-5: oklch(0.6830 0 0);
  --sidebar: oklch(0.9670 0.0029 264.5419);
  --sidebar-foreground: oklch(0.2101 0.0318 264.6645);
  --sidebar-primary: oklch(0.6716 0.1368 48.5130);
  --sidebar-primary-foreground: oklch(1.0000 0 0);
  --sidebar-accent: oklch(1.0000 0 0);
  --sidebar-accent-foreground: oklch(0.2101 0.0318 264.6645);
  --sidebar-border: oklch(0.9276 0.0058 264.5313);
  --sidebar-ring: oklch(0.6716 0.1368 48.5130);
  --destructive-foreground: oklch(0.9851 0 0);
  --font-sans: Geist Mono, ui-monospace, monospace;
  --font-serif: Besley, ui-serif, serif;
  --font-mono: Geist Mono, ui-monospace, monospace;
  --shadow-color: #000000;
  --shadow-opacity: 0.1;
  --shadow-blur: 6.5px;
  --shadow-spread: 0px;
  --shadow-offset-x: 0px;
  --shadow-offset-y: 1px;
  --letter-spacing: 0em;
  --spacing: 0.3rem;
  --shadow-2xs: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.05);
  --shadow-xs: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.05);
  --shadow-sm: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.10), 0px 1px 2px -1px hsl(0 0% 0% / 0.10);
  --shadow: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.10), 0px 1px 2px -1px hsl(0 0% 0% / 0.10);
  --shadow-md: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.10), 0px 2px 4px -1px hsl(0 0% 0% / 0.10);
  --shadow-lg: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.10), 0px 4px 6px -1px hsl(0 0% 0% / 0.10);
  --shadow-xl: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.10), 0px 8px 10px -1px hsl(0 0% 0% / 0.10);
  --shadow-2xl: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.25);
  --tracking-normal: 0em;
}

.dark {
  --background: oklch(0.2126 0.0066 314.6771);
  --foreground: oklch(0.8109 0 0);
  --card: oklch(0.1822 0 0);
  --card-foreground: oklch(0.8109 0 0);
  --popover: oklch(0.2126 0.0066 314.6771);
  --popover-foreground: oklch(0.8109 0 0);
  --primary: oklch(0.7214 0.1337 49.9802);
  --primary-foreground: oklch(0.2126 0.0066 314.6771);
  --secondary: oklch(0.5940 0.0443 196.0233);
  --secondary-foreground: oklch(0.2126 0.0066 314.6771);
  --muted: oklch(0.2520 0 0);
  --muted-foreground: oklch(0.6268 0 0);
  --accent: oklch(0.3211 0 0);
  --accent-foreground: oklch(0.8109 0 0);
  --destructive: oklch(0.5940 0.0443 196.0233);
  --border: oklch(0.2520 0 0);
  --input: oklch(0.2520 0 0);
  --ring: oklch(0.7214 0.1337 49.9802);
  --chart-1: oklch(0.5940 0.0443 196.0233);
  --chart-2: oklch(0.7214 0.1337 49.9802);
  --chart-3: oklch(0.8721 0.0864 68.5474);
  --chart-4: oklch(0.6268 0 0);
  --chart-5: oklch(0.6830 0 0);
  --sidebar: oklch(0.1822 0 0);
  --sidebar-foreground: oklch(0.8109 0 0);
  --sidebar-primary: oklch(0.7214 0.1337 49.9802);
  --sidebar-primary-foreground: oklch(0.2126 0.0066 314.6771);
  --sidebar-accent: oklch(0.3211 0 0);
  --sidebar-accent-foreground: oklch(0.8109 0 0);
  --sidebar-border: oklch(0.2520 0 0);
  --sidebar-ring: oklch(0.7214 0.1337 49.9802);
  --destructive-foreground: oklch(0.2126 0.0066 314.6771);
  --radius: 2.168rem;
  --font-sans: Geist Mono, ui-monospace, monospace;
  --font-serif: Besley, ui-serif, serif;
  --font-mono: Geist Mono, ui-monospace, monospace;
  --shadow-color: #000000;
  --shadow-opacity: 0.1;
  --shadow-blur: 6.5px;
  --shadow-spread: 0px;
  --shadow-offset-x: 0px;
  --shadow-offset-y: 1px;
  --letter-spacing: 0em;
  --spacing: 0.3rem;
  --shadow-2xs: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.05);
  --shadow-xs: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.05);
  --shadow-sm: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.10), 0px 1px 2px -1px hsl(0 0% 0% / 0.10);
  --shadow: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.10), 0px 1px 2px -1px hsl(0 0% 0% / 0.10);
  --shadow-md: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.10), 0px 2px 4px -1px hsl(0 0% 0% / 0.10);
  --shadow-lg: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.10), 0px 4px 6px -1px hsl(0 0% 0% / 0.10);
  --shadow-xl: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.10), 0px 8px 10px -1px hsl(0 0% 0% / 0.10);
  --shadow-2xl: 0px 1px 6.5px 0px hsl(0 0% 0% / 0.25);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }

  body {
    @apply bg-background text-foreground;
    letter-spacing: var(--tracking-normal);
  }
}

@layer components {

  /* Minute counter ring around circular avatars using pure CSS masks */
  @property --minute-angle {
    syntax: '<angle>';
    initial-value: 0deg;
    inherits: false;
  }

  @property --minute-thickness {
    syntax: '<length>';
    initial-value: 2px;
    inherits: false;
  }

  .turn-minute {
    position: relative;
  }

  .turn-minute::after {
    content: '';
    position: absolute;
    inset: 0px;
    border-radius: 9999px;
    background: conic-gradient(currentColor var(--minute-angle),
        transparent 0);
    -webkit-mask: radial-gradient(farthest-side,
        transparent calc(100% - var(--minute-thickness)),
        #000 0);
    mask: radial-gradient(farthest-side,
        transparent calc(100% - var(--minute-thickness)),
        #000 0);
    animation: minute-ring-sweep 60s steps(60) infinite;
    pointer-events: none;
  }

  @keyframes minute-ring-sweep {
    0% {
      --minute-angle: 0deg;
    }

    100% {
      --minute-angle: 360deg;
    }
  }
}

@layer utilities {

  /* Warning (amber) background pulse */
  @keyframes bg-pulse-warning {

    0%,
    100% {
      background-color: var(--color-amber-300)
    }

    50% {
      background-color: var(--color-amber-500)
    }
  }

  .animate-pulse-warning {
    animation: bg-pulse-warning 1.25s ease-in-out infinite;
    will-change: background-color;
  }

  /* Destructive (red) inner shadow pulse */
  @keyframes shadow-pulse-destructive {
    0%, 100% {
      box-shadow: 0 0 6px 1px var(--color-red-700) inset;
    }
    50% {
      box-shadow: 0 0 10px 4px var(--color-red-700) inset;
    }
  }

  .animate-pulse-destructive {
    animation: shadow-pulse-destructive 0.4s ease-in-out infinite;
    will-change: box-shadow;
    background-color: var(--color-red-400);
  }
}

@layer chess {
  .chess-board {
    @apply grid grid-cols-8 grid-rows-8 gap-0 w-full h-auto rounded-xs overflow-hidden;
  }

  .chess-square {
    @apply relative aspect-square flex items-center justify-center text-2xl sm:text-3xl lg:text-4xl cursor-pointer;
  }

  .chess-square.light {
    @apply bg-[#f0d9b5];
  }

  .chess-square.dark {
    @apply bg-[#b58863];
  }

  /* Radio button for square selection - hidden */
  .chess-square input[type="radio"] {
    @apply absolute inset-0 opacity-0 cursor-pointer;
  }

  /* Selected square highlighting */
  .chess-square input[type="radio"]:checked+.square-content {
    @apply ring-0 bg-blue-200/40;
  }

  /* Legal move indicators */
  .chess-square.legal-move::after {
    content: '';
    @apply absolute inset-0 flex items-center justify-center;
  }

  .chess-square.legal-move::after {
    content: '●';
    @apply text-green-500 text-lg opacity-60;
  }

  /* Last move highlighting */
  .chess-square.last-move::after {
    content: '';
    @apply absolute inset-0 bg-yellow-300/20;
  }

  /* Piece styling */
  .chess-piece {
    @apply select-none pointer-events-none;
    transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform;
  }

  /* King under check indicator */
  .chess-piece.king.king-in-check {
    position: relative;
  }

  .chess-piece.king.king-in-check::after {
    content: '!';
    @apply text-red-600 text-xs;
    position: absolute;
    top: -10%;
    right: 25%;
    font-weight: 800;
    line-height: 1;
    transform-origin: center bottom;
    animation: king-wiggle 1.1s ease-in-out infinite;
    filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.25));
  }

  @keyframes king-wiggle {

    0%,
    100% {
      transform: translate(0, 0) rotate(0deg);
    }

    10% {
      transform: translate(0.5px, -0.5px) rotate(-6deg);
    }

    20% {
      transform: translate(-0.5px, 0.5px) rotate(6deg);
    }

    30% {
      transform: translate(0.5px, -0.5px) rotate(-5deg);
    }

    40% {
      transform: translate(-0.5px, 0.5px) rotate(5deg);
    }

    50% {
      transform: translate(0.25px, -0.25px) rotate(-3deg);
    }

    60% {
      transform: translate(-0.25px, 0.25px) rotate(3deg);
    }

    70% {
      transform: translate(0px, 0px) rotate(0deg);
    }
  }

  .cry-for-help {
    --ground-y: 24px;
    --duration: 3s;

    animation: cryForHelp var(--duration) infinite ease-in-out;
    transform-origin: center bottom;
    will-change: transform;
  }

  @keyframes cryForHelp {
    0.0% { transform: translateY(var(--ground-y)) rotate(0); }
    8.1% { transform: translateY(calc(var(--ground-y) - 8px)) rotate(0); }
    16.2% { transform: translateY(var(--ground-y)) rotate(0); }
    24.3% { transform: translateY(calc(var(--ground-y) - 8px)) rotate(0); }
    32.4% { transform: translateY(var(--ground-y)) rotate(0); }
    40.5% { transform: translateY(calc(var(--ground-y) - 8px)) rotate(0); }
    48.6% { transform: translateY(var(--ground-y)) rotate(0); }
    62.2% { transform: translateY(calc(var(--ground-y) - 20px)) rotate(3deg); }
    73.0% { transform: translateY(calc(var(--ground-y) - 10px)) rotate(-1deg); }
    86.5% { transform: translateY(calc(var(--ground-y) + 1px)) rotate(-1deg); }
    100.0% { transform: translateY(var(--ground-y)) rotate(0); }
  }
  
  /* Ghostly king that rises and drifts when checkmated */
  .king-ghost {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, calc(-50% + 18px));
    transform-origin: center bottom;
    /* Start slightly faint; keyframes will fade more while rising */
    opacity: 0.55;
    filter: blur(0px); 
    animation: ghostAscend 2.6s ease-in infinite;
    will-change: transform, opacity, filter rotate;
    pointer-events: none;
  }

  @keyframes ghostAscend {
    0% {
      /* start lower, centered */
      transform: translate(-50%, calc(-50% + 18px)) scale(1) rotate(0deg);
      opacity: 0.55;
      filter: blur(0px);
    }
    20% {
      /* drift left slightly while rising */
      transform: translate(calc(-50%), calc(-50% + 12px)) scale(1.02) rotate(-5deg);
      opacity: 0.40;
      filter: blur(0.4px);
    }
    40% {
      /* drift right */
      transform: translate(calc(-50%), calc(-50% + 2px)) scale(1.03) rotate(5deg);
      opacity: 0.32;
      filter: blur(0.8px);
    }
    60% {
      /* drift left, keep floating up */
      transform: translate(calc(-50%), calc(-50% - 12px)) scale(1.05) rotate(-5deg);
      opacity: 0.24;
      filter: blur(1.2px);
    }
    80% {
      /* drift right again */
      transform: translate(calc(-50%), calc(-50% - 20px)) scale(1.07) rotate(5deg);
      opacity: 0.18;
      filter: blur(1.6px);
    }
    100% {
      /* end higher, reset on loop to start lower again */
      transform: translate(-50%, calc(-50% - 50px)) scale(1.09) rotate(-5deg);
      opacity: 0.16;
      filter: blur(2px);
    }
  }
  .chess-piece.white {
    @apply text-white;
  }

  .chess-piece.black {
    @apply text-gray-800;
  }

  .chess-square:hover .chess-piece {
    transform: scale(1.1) translateY(-4px);
  }

}